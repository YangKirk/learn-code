# 一、Java和Android环境的安装和配置

## 1. JAVA环境配置

- ### jdk下载地址:https://download.oracle.com/java

![image-20220519190750529](移动端自动化测试.assets/image-20220519190750529.png)

## 2. Android环境配置

- ### android-sdk下载地址: http://tools.android-studio.org/index.php/sdk

![image-20220519190812179](移动端自动化测试.assets/image-20220519190812179.png)

## 3.Android模拟器配置

- ### 模拟器下载地址: http://mumu.163.com

- ### 安装即可



------

# 二、ADB命令及工作原理

## 1.ADB命令原理

- ### ADB是Android Debug Bridge的简称，是android平台的调试工具。



## 2. ADB包含三个部分，Client端、Server端、Deamon守护进程

- ### Client端: 运行在开发机中，用于发送ADB命令

- ### Server端：运行在开发机中，用来管理Client和Deamon之间的通信

- ### Deamon守护进程：运行在调试设备中，手机或模拟器，用于接收并执行ADB命令

![image-20220519191356309](移动端自动化测试.assets/image-20220519191356309.png)



------

# 三、常用ADB命令

## 0.开启开发者选项并允许USB调试

![image-20220519191759726](移动端自动化测试.assets/image-20220519191759726.png)

## 1. adb命令连接真机/虚拟机

![image-20220519192011834](移动端自动化测试.assets/image-20220519192011834.png)

- ### adb devices : 列出当前已连接的所有设备

  - ### 未连接设备显示如下:

  ![image-20220522151239242](移动端自动化测试.assets/image-20220522151239242.png)

  - ### 已连接设备显示如下：

    ![image-20220522151353730](移动端自动化测试.assets/image-20220522151353730.png)

  

- ### adb connect + IP地址: 端口  ：连接指定IP地址

  ![image-20220522151424039](移动端自动化测试.assets/image-20220522151424039.png)



## 2.启动和停止adb server

![image-20220519192346230](移动端自动化测试.assets/image-20220519192346230.png)

- ### adb start-server ：启动ADB server(需要先停止ADB server)

  ![image-20220522151616812](移动端自动化测试.assets/image-20220522151616812.png)

- ### adb kill-server ：停止ADB server

  ![image-20220522151651719](移动端自动化测试.assets/image-20220522151651719.png)

- ### netstat -ano | findstr 5037 ： 查询adb端口的进程占用情况

  ![image-20220522152146031](移动端自动化测试.assets/image-20220522152146031.png)

  

- ### taskkill -f -pid 进程id ： 杀掉对应进程，释放adb端口

  ![image-20220522152258369](移动端自动化测试.assets/image-20220522152258369.png)



- ### 设计一个自动重启(断开并重连adb server)的bat脚本

  ```
  adb kill-server
  adb start-server
  adb connect 127.0.0.1:7555
  pause
  ```

  

## 3. 获取包名和activity名

- ### 包名（package name）：用于唯一标识一个app应用(注意包名不是应用名也不是apk的名字)

- ### activity名：在android中每个界面叫一个activity，获取activity其实就是获取界面名

- ### adb shell dumpsys window windows | findstr mFocusedApp : 获取当前显示的activity名

  ![image-20220522153532092](移动端自动化测试.assets/image-20220522153532092.png)



## 4.文件传输相关命令

![image-20220519200406683](移动端自动化测试.assets/image-20220519200406683.png)

- ### 从电脑发送文件到手机：adb push 电脑文件的路径名 手机文件夹路径(发送时可以更改文件名，也可以不更改)

  ![image-20220522154146852](移动端自动化测试.assets/image-20220522154146852.png)

- ### 从手机导出文件到电脑: adb pull 手机文件路径 电脑文件夹的路径

  ![image-20220522154808804](移动端自动化测试.assets/image-20220522154808804.png)



## 5.安装和卸载apk包

- ### adb install apk包路径：往默认连接的手机设备上安装apk(注意, apk文件名不能含有中文或特殊字符)

  ![image-20220522154911015](移动端自动化测试.assets/image-20220522154911015.png)

- ### adb install -r apk包路径：覆盖安装apk

  ![image-20220522155032728](移动端自动化测试.assets/image-20220522155032728.png)

- ### adb -s 127.0.0.1:7555 install apk包路径：往指定连接的设备安装apk

  ![image-20220522155150788](移动端自动化测试.assets/image-20220522155150788.png)

- ### adb uninstall **<u>包名</u>**：卸载程序

  <img src="移动端自动化测试.assets/image-20220522155545922.png" alt="image-20220522155545922"  />



## 6. 查询本机所有的应用程序包

- ### adb shell pm list packages：本机所有应用程序包

  ![image-20220522155806840](移动端自动化测试.assets/image-20220522155806840.png)

- ### adb shell pm list packages -3：第三方应用程序包

  ![image-20220522155824509](移动端自动化测试.assets/image-20220522155824509.png)



## 7.查询apk的包名和启动activity的名称

### a. 有apk包的情况下，使用aapt工具查看(在android sdk路径下的build-tools文件夹下运行，也可以设置环境变量)

- ### aapt dump badging apk文件路径 | findstr package

  ![image-20220522160248890](移动端自动化测试.assets/image-20220522160248890.png)

- ### aapt dump badging apk文件路径 | findstr launch

  ![image-20220522160341998](移动端自动化测试.assets/image-20220522160341998.png)

### b.没有apk包的情况下，直接运行adb命令查看

- ### adb shell dumpsys activity activities | findstr Run(注意大小写)： 查看当前运行的App的界面信息

  ![image-20220522160736570](移动端自动化测试.assets/image-20220522160736570.png)

  



## 8. 截取当前界面

- ### adb shell screencap 照片保存地址(注意，只能写手机里的路径)

  ![image-20220522160933326](移动端自动化测试.assets/image-20220522160933326.png)



------

# 四、Appium介绍及环境配置

## 1.什么是Appium？

![image-20220519201550138](移动端自动化测试.assets/image-20220519201550138.png)

## 2. Appium工作原理

![image-20220519201614769](移动端自动化测试.assets/image-20220519201614769.png)

## 3. Appium环境搭建配置

### a. appium客户端

- ### 下载地址:https://github.com/appium/appium-desktop/releases

### b.appium-python库

![image-20220519201825555](移动端自动化测试.assets/image-20220519201825555.png)

### c.appium启动设置(注意管理员运行)

![image-20220519201902020](移动端自动化测试.assets/image-20220519201902020.png)

```python
from appium import webdriver

desired_cap = {}

# 必须参数，定义被测脚本的平台属性，不区分大小写，但必须是android/ios
desired_cap['platformName'] = 'Android'

# 必须参数,定义被测手机的安卓版本号/ios版本，(设置->关于本机->android版本/ios版本，必须跟被测机对的上,不能乱写，大版本不能错，小版本可以不用写)
desired_cap['platformVersion'] = '6.0.1'

# 可以写任意的值，但是不能为空
desired_cap['deviceName'] = '127.0.0.1:7555'

# 必须参数，指定被测软件的包名
desired_cap['appPackage'] = 'com.android.settings'

# 必须参数，指定要打开的app的页面是哪个
desired_cap['appActivity'] = '.Settings'

# 不是必须的，但是一般需要指定Uiautomator2
desired_cap['automationName'] = 'Uiautomator2'

# 设置app的重置策略，可选参数值为默认/fullReset/noReset
# 默认: 测试后停止并清除应用数据，不卸载APP
# fullReset:在会话开始前 测试后停止app，清除app数据并卸载app
# noReset：不要停止应用程序，不要清除应用数据，不要卸载app
desired_cap['noReset'] = True

# 设置命令的超时时间
desired_cap['newCommandTimeout'] = 6000

# 用于设置中文输入
desired_cap['unicodeKeyboard'] = True
desired_cap['resetKeyboard'] = True

# 初始化
driver = webdriver.Remote('http://localhost:4723/wd/hub', desired_cap)
```



## 4.uiautomatorviewer的使用

![image-20220522212244660](移动端自动化测试.assets/image-20220522212244660.png)

- ### 常见错误

  ![image-20220522212317123](移动端自动化测试.assets/image-20220522212317123.png)



## 5.常见元素定位

### a.通过id定位

```python
# 通过id定位
# id_value: 元素的id属性值
# 注意在android中，id属性就是指resource-id的值
driver.find_element('id', id_value)
```

```python
# 代码举例
driver.find_element('id','com.ibox.calculators:id/digit4').click()
driver.find_element('id','com.ibox.calculators:id/plus').click()
dirver.find_element('id','com.ibox.calculators:id/digit5').click()
driver.find_element('id','com.ibox.calculators:id/equal').click()
```



### b.通过xpath定位

```python
# xpath_value: xpath表达式
# 在android中，toast对话框必须通过xpath
driver.find_element('xpath', xpath_value)
```

```python
# 代码举例
driver.find_element('xpath','//*[@text="="]').click()
time.sleep(1)
print(driver.find_element('xpath','//android.widget.TextView[@bounds="[40,105][706,203]"]').text)
```



## 6.对混合app元素的识别

### a.移动应用的三种常见类型:

- #### 原生应用(Native)

- #### 混合应用(Hybrid)

- #### 纯H5应用(browser)



### b.appium对于混合应用测试的步骤

![image-20220522214914980](移动端自动化测试.assets/image-20220522214914980.png)